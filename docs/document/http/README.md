# HTTP

## 应用层协议 vs 传输层协议
- 应用层协议 POP3 HTTP
- 传输层协议 TCP UDP

## 关于TCP协议
- TCP（Transmission Control Protocol， 传输控制协议）是一种面向连接的、可靠的、基于字节流的传输层通信协议。与之对应的是UDP（User Datagram Protocol ，用户数据报协议），是不可靠的传输层协议。

## TCP报文格式
![tcp image](./tcp.png)

- ACK ： TCP协议规定，只有ACK=1时有效，也规定连接建立后所有发送的报文的ACK必须为1。
- SYN(SYNchronization) ： 在连接建立时用来同步序号。当SYN=1而ACK=0时，表明这是一个连接请求报文。对方若同意建立连接，则应在响应报文中使SYN=1和ACK=1. 因此, SYN置1就表示这是一个连接请求或连接接受报文。
- FIN （finis）即完，终结的意思， 用来释放一个连接。当 FIN = 1 时，表明此报文段的发送方的数据已经发送完毕，并要求释放连接。
example
- 报文1: [ACK=0，SYN=1, seq=123] 这是询问报文，询问号是123
- 报文2: [ACK=1，SYN=1, seq=234, ack=124] 这是应答+询问报文，对seq为123的报文进行应答。询问下一个报文，询问号是234
- 报文3:[ACK=1, SYN=0, seq=124, ack=235] 这是应答报文，对seq为234的报文进行应答


## 三步握手

![三步握手真实截图](./2.png)


可以想象两人用对讲机交谈。
A：Are you ok? （SYN=1，seq=100 ）
B：I am fine. And you? (ACK=1, ack=101. SYN=1, seq=200)
A：Me too. (ACK=1, ack=201)

![三步握手示意图](./3.png)

- 客户端发送 SYN=1的询问报文给服务器端，seq是n，进入 SYN_SENT 状态。
- 服务器端回应一个ACK=1、SYN=1 的应答+询问报文。应答号ack是n+1，询问号seq是m，进入 SYN_RCVD 状态。
- 客户端收到后，回应一个 ACK=1的应答报文，应答号是m+1，进入 Established 状态。


### 为什么不能是两步？ 
- 假设是两步握手。客户端发送请求报文A，因网络延时服务器没收到。又发了一遍报文A，服务器收到后建立链接等待客户端发送数据。客户端正常发送数据。 过了一会第一次发送的报文A也到达服务器，服务器再次建立链接等待客户端发送数据，而客户端并不知情。浪费服务器资源。


## 四次挥手
客户端发送一个 FIN ，告诉服务器想关闭连接。
服务器收到这个 FIN ，发回一个 ACK。
服务器通知应用程序关闭网络连接，应用程序关闭后通知服务器。服务器发送一个 FIN 给客户端 。
客户端发回 ACK 报文确认。

## 状态码
- 1xx 信息响应 100 contine 
- 2xx 成功响应 
- 3xx 重定向
- 4xx 客户端错误
- 5xx 服务端响应

200 success 201请求成功，并因此创建了一个资源， 通常是POST，或者某些PUT

206 部分成功， 类似断点续传

301 被请求的资源已经永久移动到新的位置， 如果可能返回新的地址

302 Found   请求的资源现在临时从不同的URI响应请求。

304 Not Modified 如果发送了一个带条件的GET请求， 而文档内容自上次访问没有改变， 则服务器会返回这个状态码。 

305 User Proxy  被请求的资源必须通过指定的代理才能被访问

400 Bad Request 语义有误、参数有误

401 unauthorized 当前请求需要用户验证。响应要带一个cookie/session 来询问用户的信息

403 forbidden 服务器理解请求，但拒绝执行。

404 Not Found 请求失败，没有在服务器上找到资源

405 method not allowed 请求中指定的方法不能被用于请求相应的资源

500 Internal server error 服务器遇到了不知道如何处理的情况

501 not implemented 服务器不支持当前请求所需要的某个功能

502 Bad Gateway 作为网关或者代理工作的服务器尝试执行请求时，从上有服务器收到无效的响应

503 service unavailable 服务器没有准备好处理请求， 常见原因是服务器因维护或重载停机

504 Gateway Timeout 当服务器作为网关， 不能及时响应时返回这个代码

505 HTTP Version Not supported  服务器不支持请求中所使用的http协议版本





